<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Roboto,sans-serif;text-align:center;padding:10px;background:#f8f9fa;margin:0;}
h1{font-size:18px;margin:5px 0;}
h2{font-size:16px;margin:5px 0;}
p{font-size:14px;margin:5px 0; color:#0056b3;}
.btn{margin:3px;padding:6px 12px;font-size:14px;border-radius:6px;border:none;cursor:pointer;overflow:hidden;position:relative;}
.like{background:#28a745;color:#fff;}
.like:hover{background:#1e7e34;}
.dislike{background:#dc3545;color:#fff;}
.dislike:hover{background:#a71d2a;}
.btn-main{
  display:block;
  width:80%;
  max-width:250px;
  margin:5px auto;
  padding:10px 0;
  background:#0088cc;
  color:#fff;
  border-radius:6px;
  font-size:15px;
  cursor:pointer;
  border:none;
  font-weight:bold;
  transition: all 0.3s ease;
  overflow:hidden;
  position:relative;
}
.btn-main:hover{background:#005f8d;}
.map-btn{
  background-color:#ff8800 !important;
  color:#fff;
  font-weight:bold;
  font-size:16px;
  box-shadow:0 3px 6px rgba(0,0,0,0.2);
}
.map-btn:hover{background-color:#cc6e00 !important;transform: scale(1.05);}
.ripple{
  position:absolute;
  border-radius:50%;
  transform:scale(0);
  animation:ripple 0.6s linear;
  background-color:rgba(255,255,255,0.6);
}
@keyframes ripple{
  to{transform:scale(4);opacity:0;}
}
.counters{margin-top:5px;font-size:14px;color:#222;}
textarea,input{width:80%;max-width:250px;padding:6px;font-size:14px;border-radius:4px;border:1px solid #ccc;margin-bottom:5px;}
#commentsList{margin-top:5px;text-align:left;max-width:350px;margin-left:auto;margin-right:auto;}
.comment{background:#fff;padding:6px;margin-bottom:5px;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,0.1);}
.comment button{margin-left:3px;padding:2px 4px;font-size:10px;cursor:pointer;}
.version{position:fixed;bottom:5px;left:50%;transform:translateX(-50%);font-size:10px;color:#888;background:rgba(255,255,255,0.7);padding:2px 4px;border-radius:3px;}

/* –°—Ç–∏–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è */
.modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity 0.3s ease;
}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{
  background:#fff;padding:20px 30px;border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  text-align:center;max-width:300px;
  animation:pop 0.3s ease;
}
@keyframes pop{from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
.modal-content h3{margin:0 0 10px;color:#28a745;}
.modal-content button{background:#28a745;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
.modal-content button:hover{background:#1e7e34;}
</style>
</head>
<body>

<h1>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</h1>
<p>–ó–∞–ª–∏—à–∞–π—Ç–µ –≤—ñ–¥–≥—É–∫–∏ –ø—Ä–æ –º–∏–π–∫–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö. –ù–æ–≤—ñ –º–∏–π–∫–∏ —Ç–µ–∂ –º–æ–∂–Ω–∞ –ø–∏—Å–∞—Ç–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö —ñ –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—É.</p>

<h2>–í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
<input type="text" id="userNameInput" placeholder="–í–∞—à–µ —ñ–º'—è">
<button class="btn btn-main" onclick="signInAnon()">–£–≤—ñ–π—Ç–∏</button>

<h2>–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞</h2>
<input type="password" id="adminKey" placeholder="–ö–ª—é—á –∞–¥–º—ñ–Ω–∞">
<button class="btn btn-main" onclick="signInAdmin()">–£–≤—ñ–π—Ç–∏ —è–∫ –∞–¥–º—ñ–Ω</button>

<a id="mapLink" class="btn-main map-btn" href="map.html" style="display:none;">üó∫ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ä—Ç–∏</a>

<h2>–õ–∞–π–∫–∏/–î–∏–∑–ª–∞–π–∫–∏</h2>
<button class="btn like" onclick="vote('like')" disabled>üëç</button>
<button class="btn dislike" onclick="vote('dislike')" disabled>üëé</button>
<div class="counters">–õ–∞–π–∫–∏: <span id="likeCount">0</span> | –î–∏–∑–ª–∞–π–∫–∏: <span id="dislikeCount">0</span></div>

<h2>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
<textarea id="commentInput" rows="2" placeholder="–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä..." disabled></textarea><br>
<button class="btn btn-main" onclick="sendComment()" disabled>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
<div id="commentsList"></div>

<div class="version">–ë–µ—Ç–∞-–í–µ—Ä—Å—ñ—è 1.0.0</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <h3>‚úÖ –í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π!</h3>
    <p id="modalText"></p>
    <button onclick="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCG5mxvBurQdQeSz6dIo-Qd5UJEwnhCxpA",
  authDomain: "miyjky.firebaseapp.com",
  databaseURL: "https://miyjky-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "miyjky",
  storageBucket: "miyjky.firebasestorage.app",
  messagingSenderId: "967414135211",
  appId: "1:967414135211:web:9b3444523a807626dbfaee"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let currentUserUID = null;
let currentUserName = null;
let latestComments = {};
let isAdmin = false;

// --- Ripple –µ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ ---
document.addEventListener("click", function(e){
  if(e.target.classList.contains("btn-main")){
    let circle=document.createElement("span");
    circle.classList.add("ripple");
    let rect=e.target.getBoundingClientRect();
    circle.style.width=circle.style.height=Math.max(rect.width,rect.height)+"px";
    circle.style.left=(e.clientX-rect.left-circle.offsetWidth/2)+"px";
    circle.style.top=(e.clientY-rect.top-circle.offsetHeight/2)+"px";
    e.target.appendChild(circle);
    setTimeout(()=>circle.remove(),600);
  }
});

// --- –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ---
window.onload = function(){
  const savedName = localStorage.getItem('userName');
  if(savedName){
    document.getElementById('userNameInput').value = savedName;
    currentUserName = savedName;
  }
}

// --- –ê–Ω–æ–Ω—ñ–º–Ω–∏–π –≤—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ---
function signInAnon(){
  let name = document.getElementById('userNameInput').value.trim();
  if(!name && localStorage.getItem('userName')) name = localStorage.getItem('userName');
  if(!name) return showModal("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è!");
  firebase.auth().signInAnonymously().then(res=>{
    currentUserUID = res.user.uid;
    currentUserName = name;
    localStorage.setItem('userName', name);
    enableUI();
    showModal("–ü—Ä–∏–≤—ñ—Ç, "+name);
  });
}

// --- –í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞ ---
function signInAdmin(){
  const key = document.getElementById('adminKey').value.trim();
  if(key==="admin123"){
    isAdmin = true;
    firebase.auth().signInAnonymously().then(res=>{
      currentUserUID = res.user.uid;
      currentUserName = "–ê–¥–º—ñ–Ω";
      enableUI();
      showModal("–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞ —É—Å–ø—ñ—à–Ω–∏–π!");
    });
  }else showModal("‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –∫–ª—é—á!");
}

// --- –ê–∫—Ç–∏–≤—É—î–º–æ UI ---
function enableUI(){
  document.querySelector('.like').disabled = false;
  document.querySelector('.dislike').disabled = false;
  document.querySelector('#commentInput').disabled = false;
  document.querySelector('button[onclick="sendComment()"]').disabled = false;
  document.getElementById('mapLink').style.display = 'block';
  updateCounters();
}

// --- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ ---
let modalTimeout;
function showModal(msg){
  document.getElementById("modalText").innerText = msg;
  document.getElementById("successModal").classList.add("show");
  clearTimeout(modalTimeout);
  modalTimeout = setTimeout(()=>closeModal(),3000); // –∞–≤—Ç–æ-–∑–∞–∫—Ä–∏—Ç—Ç—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫
}
function closeModal(){
  document.getElementById("successModal").classList.remove("show");
}

// --- –õ–∞–π–∫–∏/–î–∏–∑–ª–∞–π–∫–∏ ---
function updateCounters(){
  db.ref('votes').once('value').then(snap=>{
    const d = snap.val() || {likes:0, dislikes:0};
    document.getElementById('likeCount').innerText = d.likes||0;
    document.getElementById('dislikeCount').innerText = d.dislikes||0;
  });
}
function vote(type){
  if(!currentUserUID) return showModal("–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  const ref = db.ref('votes/users/'+currentUserUID);
  ref.once('value').then(snap=>{
    if(snap.exists()) return showModal("–í–∏ –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏!");
    ref.set(type);
    db.ref('votes').transaction(d=>{
      if(!d) d={likes:0,dislikes:0,users:{}};
      if(type==='like') d.likes=(d.likes||0)+1;
      if(type==='dislike') d.dislikes=(d.dislikes||0)+1;
      return d;
    });
  });
}
db.ref('votes').on('value', snap=>{
  const d = snap.val()||{likes:0,dislikes:0};
  document.getElementById('likeCount').innerText = d.likes||0;
  document.getElementById('dislikeCount').innerText = d.dislikes||0;
});

// --- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ---
function sendComment(){
  const t = document.getElementById('commentInput').value.trim();
  if(!t) return showModal("–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä!");
  if(!currentUserUID) return showModal("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  db.ref('comments').push().set({
    uid: currentUserUID,
    name: currentUserName,
    text: t,
    timestamp: Date.now()
  });
  document.getElementById('commentInput').value='';
}

db.ref('comments').on('value', snap=>{
  latestComments = snap.val()||{};
  renderComments(latestComments);
});

function renderComments(c){
  const div = document.getElementById('commentsList');
  div.innerHTML='';
  Object.entries(c).sort((a,b)=>a[1].timestamp-b[1].timestamp).forEach(([k,cm])=>{
    const d = document.createElement('div'); d.className='comment';
    let txt = `<strong>${cm.name}:</strong> ${cm.text}`;
    if(cm.replies) Object.entries(cm.replies).sort((a,b)=>a[1].timestamp-b[1].timestamp).forEach(([rk,r])=>{
      txt += `<br><em>${r.adminName} –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î:</em> ${r.text}`;
    });
    d.innerHTML = txt;

    if(cm.uid===currentUserUID){
      const e = document.createElement('button'); e.innerText='–†–µ–¥–∞–≥—É–≤–∞—Ç–∏'; e.onclick=()=>editComment(k,cm.text); d.appendChild(e);
    }
    if(isAdmin){
      const del = document.createElement('button'); del.innerText='–í–∏–¥–∞–ª–∏—Ç–∏'; del.onclick=()=>deleteComment(k); d.appendChild(del);
      const rep = document.createElement('button'); rep.innerText='–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏'; rep.onclick=()=>replyComment(k,cm.name); d.appendChild(rep);
    }
    div.appendChild(d);
  });
}

// --- –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è/–í–∏–¥–∞–ª–µ–Ω–Ω—è/–í—ñ–¥–ø–æ–≤—ñ–¥—å ---
function editComment(id,old){const n=prompt("–†–µ–¥–∞–≥—É–≤–∞—Ç–∏:",old);if(n!==null) db.ref('comments/'+id+'/text').set(n);}
function deleteComment(id){if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä?")) db.ref('comments/'+id).remove();}
function replyComment(id,name){const r=prompt("–í—ñ–¥–ø–æ–≤—ñ–¥—å –¥–ª—è "+name+":");if(r) db.ref('comments/'+id+'/replies').push().set({adminName:'–ê–¥–º—ñ–Ω',text:r,timestamp:Date.now()});}
</script>

</body>
</html>
