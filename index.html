<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Roboto,sans-serif;text-align:center;padding:10px;background:#f8f9fa;margin:0;overflow-x:hidden;}
h1{font-size:18px;margin:5px 0;}
h2{font-size:16px;margin:5px 0;}
p{font-size:14px;margin:5px 0; color:#0056b3;}
.btn{margin:3px;padding:6px 12px;font-size:14px;border-radius:6px;border:none;cursor:pointer;overflow:hidden;position:relative;}
.like{background:#28a745;color:#fff;}
.like:hover{background:#1e7e34;}
.dislike{background:#dc3545;color:#fff;}
.dislike:hover{background:#a71d2a;}
.btn-main{
  display:block;
  width:80%;
  max-width:250px;
  margin:5px auto;
  padding:10px 0;
  background:#0088cc;
  color:#fff;
  border-radius:6px;
  font-size:15px;
  cursor:pointer;
  border:none;
  font-weight:bold;
  transition: all 0.3s ease;
  overflow:hidden;
  position:relative;
}
.btn-main:hover{background:#005f8d;}
.map-btn{
  background-color:#ff8800 !important;
  color:#fff;
  font-weight:bold;
  font-size:16px;
  box-shadow:0 3px 6px rgba(0,0,0,0.2);
}
.map-btn:hover{background-color:#cc6e00 !important;transform: scale(1.05);}
.counters{margin-top:5px;font-size:14px;color:#222;}
textarea,input{width:80%;max-width:250px;padding:6px;font-size:14px;border-radius:4px;border:1px solid #ccc;margin-bottom:5px;}
#commentsList{margin-top:5px;text-align:left;max-width:350px;margin-left:auto;margin-right:auto;}
.comment{background:#fff;padding:6px;margin-bottom:5px;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,0.1);}
.comment button{margin-left:3px;padding:2px 4px;font-size:10px;cursor:pointer;}
.version{position:fixed;bottom:5px;left:50%;transform:translateX(-50%);font-size:10px;color:#888;background:rgba(255,255,255,0.7);padding:2px 4px;border-radius:3px;}
.modal{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity 0.3s ease;
}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{
  background:#fff;padding:20px 30px;border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  text-align:center;max-width:300px;
  animation:pop 0.3s ease;
}
@keyframes pop{from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
.modal-content h3{margin:0 0 10px;color:#28a745;}
.modal-content button{background:#28a745;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
.modal-content button:hover{background:#1e7e34;}
/* –ê–∫—Ç–∏–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏ */
.active-like{background:#1e7e34 !important;}
.active-dislike{background:#a71d2a !important;}
</style>
</head>
<body>

<h1>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</h1>
<p>–ó–∞–ª–∏—à–∞–π—Ç–µ –≤—ñ–¥–≥—É–∫–∏ –ø—Ä–æ –º–∏–π–∫–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö. –ù–æ–≤—ñ –º–∏–π–∫–∏ —Ç–µ–∂ –º–æ–∂–Ω–∞ –ø–∏—Å–∞—Ç–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö —ñ –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—É.</p>

<!-- –ü–æ–ª—è –¥–ª—è –≤—Ö–æ–¥—É -->
<div id="loginSection">
  <input type="text" id="userNameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è">
  <button class="btn btn-main" onclick="signInAnon()">–£–≤—ñ–π—Ç–∏</button>
  <input type="password" id="adminKey" placeholder="–ö–ª—é—á –∞–¥–º—ñ–Ω–∞">
  <button class="btn btn-main" onclick="signInAdmin()">–£–≤—ñ–π—Ç–∏ —è–∫ –∞–¥–º—ñ–Ω</button>
</div>

<!-- –ü–æ–∫–∞–∑ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∫–Ω–æ–ø–∫–∞ –≤–∏—Ö–æ–¥—É -->
<h2 id="userDisplay" style="margin-top:10px; font-weight:bold;"></h2>
<button id="logoutBtn" class="btn btn-main" style="display:none;background:#dc3545;" onclick="logout()">üö™ –í–∏–π—Ç–∏</button>

<a id="mapLink" class="btn-main map-btn" href="map.html" style="display:none;">üó∫ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ä—Ç–∏</a>

<h2></h2>
<button class="btn like" onclick="vote('like')" disabled id="likeBtn">üëç</button>
<button class="btn dislike" onclick="vote('dislike')" disabled id="dislikeBtn">üëé</button>
<div class="counters">–õ–∞–π–∫–∏: <span id="likeCount">0</span> | –î–∏–∑–ª–∞–π–∫–∏: <span id="dislikeCount">0</span></div>

<h2>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
<textarea id="commentInput" rows="2" placeholder="–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä..." disabled></textarea><br>
<button class="btn btn-main" onclick="sendComment()" disabled>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
<div id="commentsList"></div>

<div class="version">–ë–µ—Ç–∞-–í–µ—Ä—Å—ñ—è 1.0.0</div>

<div id="successModal" class="modal">
  <div class="modal-content">
    <h3>‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>
    <p id="modalText"></p>
    <button onclick="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCG5mxvBurQdQeSz6dIo-Qd5UJEwnhCxpA",
  authDomain: "miyjky.firebaseapp.com",
  databaseURL: "https://miyjky-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "miyjky",
  storageBucket: "miyjky.firebasestorage.app",
  messagingSenderId: "967414135211",
  appId: "1:967414135211:web:9b3444523a807626dbfaee"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let currentUserUID = null;
let currentUserName = null;
let latestComments = {};
let isAdmin = false;
let modalTimeout;

// --- –ê–≤—Ç–æ–≤—Ö—ñ–¥ ---
window.onload = function(){
  const savedUID = localStorage.getItem('userUID');
  const savedName = localStorage.getItem('userName');
  const savedAdmin = localStorage.getItem('isAdmin') === 'true';
  if(savedUID && savedName){
    currentUserUID = savedUID;
    currentUserName = savedName;
    isAdmin = savedAdmin;
    enableUI();
    checkUserVote();
  }
}

// --- –í—Ö—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ---
function signInAnon(){
  let name = document.getElementById('userNameInput').value.trim();
  if(!name) return showModal("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è!");
  firebase.auth().signInAnonymously().then(res=>{
    currentUserUID = res.user.uid;
    currentUserName = name;
    isAdmin = false;
    localStorage.setItem('userUID', currentUserUID);
    localStorage.setItem('userName', name);
    localStorage.setItem('isAdmin', false);
    enableUI();
    checkUserVote();
    showModal("–ü—Ä–∏–≤—ñ—Ç, "+name);
  });
}

// --- –í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞ ---
function signInAdmin(){
  const key = document.getElementById('adminKey').value.trim();
  if(key==="admin123"){
    isAdmin = true;
    firebase.auth().signInAnonymously().then(res=>{
      currentUserUID = res.user.uid;
      currentUserName = "–ê–¥–º—ñ–Ω";
      localStorage.setItem('userUID', currentUserUID);
      localStorage.setItem('userName', currentUserName);
      localStorage.setItem('isAdmin', true);
      enableUI();
      checkUserVote();
      showModal("–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞ —É—Å–ø—ñ—à–Ω–∏–π!");
    });
  } else showModal("‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –∫–ª—é—á!");
}

// --- –í–∏–π—Ç–∏ ---
function logout(){
  firebase.auth().signOut().then(()=>{
    localStorage.clear();
    currentUserUID = null;
    currentUserName = null;
    isAdmin = false;

    // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—è –¥–ª—è –≤—Ö–æ–¥—É
    document.getElementById('loginSection').style.display = 'block';

    document.getElementById('likeBtn').disabled = true;
    document.getElementById('dislikeBtn').disabled = true;
    document.querySelector('#commentInput').disabled = true;
    document.querySelector('button[onclick="sendComment()"]').disabled = true;
    document.getElementById('mapLink').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'none';
    document.getElementById('userDisplay').innerText = '';

    showModal("–í–∏ –≤–∏–π—à–ª–∏ –∑ –∞–∫–∞—É–Ω—Ç—É!");
  });
}

// --- –ê–∫—Ç–∏–≤—É—î–º–æ UI –ø—ñ—Å–ª—è –≤—Ö–æ–¥—É ---
function enableUI(){
  document.getElementById('likeBtn').disabled = false;
  document.getElementById('dislikeBtn').disabled = false;
  document.querySelector('#commentInput').disabled = false;
  document.querySelector('button[onclick="sendComment()"]').disabled = false;
  document.getElementById('mapLink').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'block';

  // –•–æ–≤–∞—î–º–æ –ø–æ–ª—è –¥–ª—è –≤—Ö–æ–¥—É
  document.getElementById('loginSection').style.display = 'none';

  // –ü–æ–∫–∞–∑ —ñ–º–µ–Ω—ñ
  document.getElementById('userDisplay').innerText = "–ü—Ä–∏–≤—ñ—Ç, " + currentUserName;

  updateCounters();
}

// --- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ ---
function showModal(msg){
  document.getElementById("modalText").innerText = msg;
  const modal = document.getElementById("successModal");
  modal.classList.add("show");
  clearTimeout(modalTimeout);
  modalTimeout = setTimeout(()=>closeModal(),3000);
}
function closeModal(){ document.getElementById("successModal").classList.remove("show"); }

// --- –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è ---
function updateCounters(){
  db.ref('votes').once('value').then(snap=>{
    const d = snap.val() || {likes:0, dislikes:0};
    document.getElementById('likeCount').innerText = d.likes||0;
    document.getElementById('dislikeCount').innerText = d.dislikes||0;
  });
}
function vote(type){
  if(!currentUserUID) return showModal("–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  const ref = db.ref('votes/users/'+currentUserUID);
  ref.once('value').then(snap=>{
    if(snap.exists()) return showModal("–í–∏ –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏!");
    ref.set(type);
    db.ref('votes').transaction(d=>{
      if(!d) d={likes:0,dislikes:0,users:{}};
      if(type==='like') d.likes=(d.likes||0)+1;
      if(type==='dislike') d.dislikes=(d.dislikes||0)+1;
      return d;
    });
    markVoted(type);
  });
}
db.ref('votes').on('value', snap=>{
  const d = snap.val()||{likes:0,dislikes:0};
  document.getElementById('likeCount').innerText = d.likes||0;
  document.getElementById('dislikeCount').innerText = d.dislikes||0;
});
function checkUserVote(){
  if(!currentUserUID) return;
  db.ref('votes/users/'+currentUserUID).once('value').then(snap=>{
    if(snap.exists()) markVoted(snap.val());
  });
}
function markVoted(type){
  document.getElementById('likeBtn').disabled = true;
  document.getElementById('dislikeBtn').disabled = true;
  if(type==='like') document.getElementById('likeBtn').classList.add('active-like');
  if(type==='dislike') document.getElementById('dislikeBtn').classList.add('active-dislike');
}

// --- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ---
function sendComment(){
  const t = document.getElementById('commentInput').value.trim();
  if(!t) return showModal("–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä!");
  if(!currentUserUID) return showModal("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  db.ref('comments').push().set({
    uid: currentUserUID,
    name: currentUserName,
    text: t,
    timestamp: Date.now()
  });
  document.getElementById('commentInput').value='';
}
db.ref('comments').on('value', snap=>{
  latestComments = snap.val()||{};
  renderComments(latestComments);
});
function renderComments(c){
  const div = document.getElementById('commentsList');
  div.innerHTML='';
  Object.entries(c).sort((a,b)=>a[1].timestamp-b[1].timestamp).forEach(([k,cm])=>{
    const d = document.createElement('div'); d.className='comment';
    d.innerHTML = `<strong>${cm.name}:</strong> ${cm.text}`;
    div.appendChild(d);
  });
}
</script>
</body>
</html>
